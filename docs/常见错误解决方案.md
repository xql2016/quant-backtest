# ⚠️ 常见错误解决方案

## 错误1：无法获取股票代码数据

### 错误现象
```
❌ 无法获取代码 000002 的数据，请检查代码是否正确，或该股在区间内已退市。
```

### 原因分析
1. **股票代码可能有问题**
   - 某些股票代码在特定数据源中不可用
   - 股票可能已退市或停牌
   
2. **数据源不稳定**
   - AKShare API 可能不稳定
   - 网络连接问题

3. **网络连接错误**
   ```
   RemoteDisconnected: Remote end closed connection without response
   ```
   服务器主动关闭连接

### ✅ 解决方案

#### 方案1：切换到 Tushare 数据源（最推荐）

**操作步骤：**
1. 在应用中选择数据源：`Tushare (A股/可转债)`
2. 市场选择：`A股`
3. 输入稳定的股票代码：
   - `000001` - 平安银行 ✅
   - `600519` - 贵州茅台 ✅
   - `600036` - 招商银行 ✅

**为什么推荐 Tushare？**
- ✅ 数据质量高
- ✅ API 稳定
- ✅ 网络连接可靠
- ✅ 已内置 Token

#### 方案2：更换股票代码

如果一定要使用 AKShare，避免使用以下代码：
- ❌ `000002` - 万科A（可能有问题）

推荐使用这些代码：
- ✅ `000001` - 平安银行
- ✅ `000858` - 五粮液
- ✅ `600519` - 贵州茅台
- ✅ `600036` - 招商银行
- ✅ `601318` - 中国平安

#### 方案3：重试机制

系统已添加自动重试功能：
- 网络错误会自动重试 3 次
- 每次重试间隔 2 秒
- 如果仍然失败，切换到 Tushare

---

## 错误2：网络连接问题

### 错误现象
```
RemoteDisconnected: Remote end closed connection without response
502 Bad Gateway
Connection reset by peer
```

### 原因分析
1. **AKShare API 服务器问题**
   - 东方财富服务器不稳定
   - 高峰期可能拒绝连接

2. **网络环境限制**
   - 公司网络可能有限制
   - 防火墙拦截

3. **请求频率过高**
   - 短时间内多次请求
   - 触发服务器限制

### ✅ 解决方案

#### 即时解决
1. **刷新页面重试**
   - 系统会自动重试 3 次
   - 等待 5-10 秒后再试

2. **切换数据源**
   - 使用 Tushare 数据源
   - 更稳定可靠

3. **检查网络连接**
   ```bash
   python test/diagnose_network.py
   ```

#### 长期解决
1. **优先使用 Tushare**
   - 在设置中默认选择 Tushare
   - 数据质量和稳定性最好

2. **避免频繁请求**
   - 利用 Streamlit 的缓存机制
   - 不要短时间内多次回测

---

## 错误3：Streamlit API 警告

### 错误现象
```
Please replace `use_container_width` with `width`.
`use_container_width` will be removed after 2025-12-31.
```

### 解决方案
✅ **已自动修复** - 代码已更新为新的 API

---

## 📊 推荐的测试配置

### ✅ 稳定配置（推荐新手）

```
数据源：Tushare (A股/可转债)
市场：A股
代码：000001（平安银行）
日期：2024-01-01 至 2024-12-31
策略：双均线策略
参数：短期=5, 长期=20
```

### ✅ 备选配置

```
数据源：Tushare (A股/可转债)
市场：A股
代码：600519（贵州茅台）
日期：2024-01-01 至 2024-12-31
策略：MACD趋势策略
参数：默认
```

---

## 🔧 诊断工具

### 快速诊断
```bash
# 测试系统是否正常
python test/quick_test.py

# 诊断网络问题
python test/diagnose_network.py

# 诊断 AKShare
python test/diagnose_akshare.py
```

### 清理缓存
```bash
# 清理 Python 和 Streamlit 缓存
python test/clear_cache.py

# 重启应用
pkill -f "streamlit run"
python -m streamlit run run_main.py
```

---

## 💡 使用建议

### DO（推荐做法）
✅ 优先使用 Tushare 数据源
✅ 使用常见的大盘股代码
✅ 选择合理的日期范围（不超过3年）
✅ 利用系统的自动重试机制
✅ 查看终端输出的详细错误信息

### DON'T（不推荐）
❌ 不要使用已退市的股票代码
❌ 不要短时间内频繁请求
❌ 不要使用过长的日期范围（>5年）
❌ 不要忽略错误提示直接重试
❌ 不要在网络不稳定时使用 AKShare

---

## 🆘 仍然有问题？

### 检查清单
1. ☐ 是否使用了 Tushare 数据源？
2. ☐ 股票代码是否正确？（试试 000001）
3. ☐ 网络连接是否正常？
4. ☐ 是否清理了缓存？
5. ☐ 是否查看了终端详细错误？

### 获取帮助
1. 查看详细文档：`docs/DATASOURCE_ISSUE_SUMMARY.md`
2. 运行诊断工具：`python test/diagnose_network.py`
3. 查看测试脚本：`test/README.md`

---

**最后更新：** 2026-02-08
**适用版本：** 1.0.0+

# ç¼“å­˜ä¼˜åŒ–å·¥å…·å¿«é€ŸæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€ç®€å•çš„æ–¹å¼ï¼šä¸€é”®ä¼˜åŒ– â­

```bash
# 1. å…ˆçœ‹çœ‹èƒ½ä¼˜åŒ–ä»€ä¹ˆ
python tools/auto_optimize_cache.py --report

# 2. é¢„è§ˆå°†è¦æ‰§è¡Œçš„æ“ä½œ
python tools/auto_optimize_cache.py

# 3. ç¡®è®¤åæ‰§è¡Œ
python tools/auto_optimize_cache.py --execute
```

---

## ğŸ“‹ ä¸‰ä¸ªå·¥å…·è¯´æ˜

| å·¥å…· | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `auto_optimize_cache.py` | è‡ªåŠ¨ä¼˜åŒ–æ‰€æœ‰ç¼“å­˜ | **æ¨èï¼šå®šæœŸç»´æŠ¤** |
| `merge_continuous_caches.py` | åˆå¹¶ä¸¤ä¸ªè¿ç»­ç¼“å­˜ | æ‰‹åŠ¨åˆå¹¶ç‰¹å®šç¼“å­˜ |
| `check_cache_overlap.py` | æ¸…ç†è¢«è¦†ç›–çš„ç¼“å­˜ | æ‰‹åŠ¨æ¸…ç†ç‰¹å®šç¼“å­˜ |

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šè‡ªåŠ¨ä¼˜åŒ–æ‰€æœ‰ç¼“å­˜ï¼ˆæ¨èï¼‰

```bash
# ç”ŸæˆæŠ¥å‘Š
python tools/auto_optimize_cache.py --report

# è¾“å‡º:
# ğŸ“Š ä¼˜åŒ–æ½œåŠ›æ€»ç»“
# ================================================================================
# å¯åˆ é™¤å†—ä½™ç¼“å­˜: 3 ä¸ª
# å¯åˆå¹¶è¿ç»­ç¼“å­˜: 2 å¯¹
# å¯é‡Šæ”¾ç©ºé—´: 85.5 MB

# æ‰§è¡Œä¼˜åŒ–
python tools/auto_optimize_cache.py --execute
```

### ç¤ºä¾‹2ï¼šæ‰‹åŠ¨åˆå¹¶ä¸¤ä¸ªè¿ç»­ç¼“å­˜

```bash
# ä½ æœ‰ä¸¤ä¸ªç¼“å­˜ï¼š
# - 000001_20250101_20250630.parquet
# - 000001_20250701_20251231.parquet

python tools/merge_continuous_caches.py \
  tushare/a_stock/000001_20250101_20250630.parquet \
  tushare/a_stock/000001_20250701_20251231.parquet

# ç»“æœï¼šç”Ÿæˆ 000001_20250101_20251231.parquet
```

### ç¤ºä¾‹3ï¼šæ¸…ç†è¢«è¦†ç›–çš„ç¼“å­˜

```bash
# ä½ æœ‰ä¸¤ä¸ªç¼“å­˜ï¼š
# - 000001_20240101_20260101.parquet (å¤§)
# - 000001_20250101_20260101.parquet (å°ï¼Œè¢«è¦†ç›–)

python tools/check_cache_overlap.py \
  tushare/a_stock/000001_20240101_20260101.parquet \
  tushare/a_stock/000001_20250101_20260101.parquet

# ç»“æœï¼šåˆ é™¤å°çš„ï¼Œä¿ç•™å¤§çš„
```

---

## âš ï¸ å®‰å…¨æç¤º

### 1. å§‹ç»ˆå…ˆç”¨é¢„è§ˆæ¨¡å¼

```bash
# æ‰€æœ‰å·¥å…·éƒ½æ”¯æŒé¢„è§ˆ
python tools/auto_optimize_cache.py          # é¢„è§ˆï¼ˆé»˜è®¤ï¼‰
python tools/merge_continuous_caches.py file1 file2 --dry-run
python tools/check_cache_overlap.py file1 file2 --dry-run
```

### 2. å¤‡ä»½ç´¢å¼•ï¼ˆå¯é€‰ï¼‰

```bash
cp cache/metadata/cache_index.json cache/metadata/cache_index.json.backup
```

### 3. å·¥å…·æ˜¯å¹‚ç­‰çš„

å¤šæ¬¡è¿è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚

---

## ğŸ¯ æ¨èå·¥ä½œæµ

```bash
# ç¬¬1æ­¥ï¼šæŸ¥çœ‹å½“å‰çŠ¶æ€
python test/cache_tool.py --stats

# ç¬¬2æ­¥ï¼šç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š
python tools/auto_optimize_cache.py --report

# ç¬¬3æ­¥ï¼šæ‰§è¡Œä¼˜åŒ–
python tools/auto_optimize_cache.py --execute

# ç¬¬4æ­¥ï¼šéªŒè¯ç»“æœ
python test/cache_tool.py --stats
```

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- å®Œæ•´ä½¿ç”¨æŒ‡å—ï¼š`tools/README.md`
- å®ç°æ€»ç»“ï¼š`docs/ç¼“å­˜ä¼˜åŒ–å·¥å…·å®ç°æ€»ç»“.md`

---

## ğŸ’¡ å®šæœŸç»´æŠ¤å»ºè®®

```bash
# æ¯å‘¨è¿è¡Œä¸€æ¬¡è‡ªåŠ¨ä¼˜åŒ–
# å¯ä»¥æ·»åŠ åˆ° crontab:
0 3 * * 0 cd /path/to/quant-backtest && python tools/auto_optimize_cache.py --execute
```

---

## â“ å¸¸è§é—®é¢˜

**Q: åˆå¹¶ä¼šä¸¢å¤±æ•°æ®å—ï¼Ÿ**
A: ä¸ä¼šã€‚å·¥å…·ä¼šéªŒè¯è¿ç»­æ€§ï¼Œæœ‰ç¼ºå£ä¸ä¼šåˆå¹¶ã€‚

**Q: åˆ é™¤ä¼šè¯¯åˆ å—ï¼Ÿ**
A: ä¸ä¼šã€‚åªåˆ é™¤è¢«å®Œå…¨è¦†ç›–çš„ç¼“å­˜ã€‚

**Q: å¯ä»¥æ’¤é”€å—ï¼Ÿ**
A: å·¥å…·æœ¬èº«ä¸æ”¯æŒï¼Œå»ºè®®ä½¿ç”¨é¢„è§ˆæ¨¡å¼ç¡®è®¤åå†æ‰§è¡Œã€‚

**Q: å¤šä¹…è¿è¡Œä¸€æ¬¡ï¼Ÿ**
A: å»ºè®®æ¯å‘¨ä¸€æ¬¡ï¼Œæˆ–å½“ç¼“å­˜æ–‡ä»¶è¾ƒå¤šæ—¶ã€‚

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥è‡ªåŠ¨åŒ–ç®¡ç†ç¼“å­˜äº†ï¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£æˆ–è¿è¡Œå·¥å…·çš„ `--help`ã€‚

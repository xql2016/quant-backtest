# 加密货币1小时线功能说明

## 📋 功能概述

系统现已支持**加密货币1小时线数据**，为短线和日内交易策略提供更精细的数据粒度。

---

## ✨ 新增功能

### 1️⃣ 时间粒度选择器

在侧边栏"股票代码"下方，新增了**"⏰ 时间粒度"**选择器：

- **日线 (1d)**：默认选项，所有市场均支持
- **1小时线 (1h)**：仅加密货币市场支持

### 2️⃣ 智能显示逻辑

- **加密货币市场**：显示时间粒度选择器，可选日线或1小时线
- **其他市场**（美股、港股、A股）：自动使用日线，显示提示信息

---

## 🚀 使用方法

### 步骤1：选择数据源和市场

```
1. 数据源：选择 "YFinance (全球市场/加密货币)"
2. 市场：选择 "加密货币"
```

### 步骤2：输入加密货币代码

**常用加密货币代码：**
- `BTC-USD` - 比特币
- `ETH-USD` - 以太坊
- `BNB-USD` - 币安币
- `SOL-USD` - Solana
- `ADA-USD` - Cardano
- `XRP-USD` - 瑞波币

### 步骤3：选择时间粒度

在**"⏰ 时间粒度"**下拉框中选择：
- **日线 (1d)**：适合中长线策略
- **1小时线 (1h)**：适合短线和日内策略

### 步骤4：设置回测区间

⚠️ **重要提示：**
- **1小时线最多支持730天（约2年）的历史数据**
- 如果回测区间超过730天，系统会显示警告提示
- 建议1小时线回测区间：7天至90天

### 步骤5：选择策略并开始回测

选择合适的交易策略，点击 **"🚀 开始回测"**

---

## 📊 使用场景

### 🎯 适合1小时线的策略

1. **日内交易策略**
   - 短周期MACD（如5-13-5）
   - 短周期RSI（如6期或9期）
   - 快速双均线（如3-8）

2. **波段交易策略**
   - 捕捉4-12小时的短期波段
   - 适合加密货币的高波动性

3. **高频回测**
   - 需要更多交易样本
   - 测试策略在不同时间周期的表现

### 📈 适合日线的策略

1. **趋势跟踪策略**
   - 标准MACD（12-26-9）
   - 长周期双均线（20-60）

2. **中长期持仓**
   - 适合捕捉大级别趋势
   - 减少交易频率

---

## 💡 使用示例

### 示例1：比特币短线MACD策略（1小时线）

```
配置：
- 数据源：YFinance
- 市场：加密货币
- 代码：BTC-USD
- 时间粒度：1小时线 (1h)
- 回测区间：最近30天
- 策略：MACD趋势策略
  - 快线：5
  - 慢线：13
  - 信号：5
```

**预期效果：**
- 约 720 条小时K线数据（30天 × 24小时）
- 更多交易信号，适合捕捉短期趋势

### 示例2：以太坊RSI策略（1小时线）

```
配置：
- 数据源：YFinance
- 市场：加密货币
- 代码：ETH-USD
- 时间粒度：1小时线 (1h)
- 回测区间：最近60天
- 策略：RSI超买超卖
  - RSI周期：6
  - 超卖阈值：25
  - 超买阈值：75
```

**预期效果：**
- 约 1440 条小时K线数据（60天 × 24小时）
- 更频繁的超买超卖信号

### 示例3：比特币中期趋势（日线）

```
配置：
- 数据源：YFinance
- 市场：加密货币
- 代码：BTC-USD
- 时间粒度：日线 (1d)
- 回测区间：最近3年
- 策略：双均线策略
  - 短期：20
  - 长期：60
```

**预期效果：**
- 约 1095 条日K线数据（3年）
- 捕捉中长期趋势

---

## ⚠️ 注意事项

### 1. 数据量限制

| 时间粒度 | 最大回溯天数 | 建议回测区间 |
|---------|-------------|-------------|
| 1小时线 | 730天（2年） | 7-90天 |
| 日线 | 无限制 | 1-10年 |

### 2. 加密货币特点

- ✅ **24小时交易**：1小时线数据连续完整
- ✅ **高波动性**：适合短线策略测试
- ⚠️ **价格跳动大**：需要合理设置止损

### 3. 策略参数调整建议

使用1小时线时，建议调整策略参数：

| 策略 | 日线参数 | 1小时线参数 |
|-----|---------|------------|
| MACD | 12-26-9 | 5-13-5 或 6-19-6 |
| RSI | 14期 | 6期 或 9期 |
| 双均线 | 5-20 | 3-8 或 5-13 |
| 布林带 | 20期 | 10期 或 15期 |

### 4. 性能考虑

- 1小时线数据量是日线的24倍
- 回测计算时间会相应增加
- 建议首次使用时选择较短的回测区间（如7-30天）

### 5. 市场限制

- ✅ **仅加密货币支持1小时线**
- ❌ 美股、港股、A股暂不支持小时级数据
- 💡 其他市场自动使用日线

---

## 🔍 技术说明

### 数据来源

- **数据源**：YFinance API
- **更新频率**：实时（有几分钟延迟）
- **数据质量**：加密货币数据完整，无缺失

### 实现细节

1. **interval 参数**：传递给 YFinance API
   - `interval='1h'` - 1小时线
   - `interval='1d'` - 日线（默认）

2. **数据标准化**：
   - 统一的 OHLCV 格式
   - 自动去除时区信息
   - 确保数据类型正确

3. **缓存机制**：
   - 使用 Streamlit 缓存
   - TTL：3600秒（1小时）
   - 避免重复请求

---

## 📈 性能对比

### 数据量对比（以30天回测为例）

| 时间粒度 | 数据条数 | 数据量倍数 | 回测耗时（估算） |
|---------|---------|-----------|----------------|
| 日线 | 30条 | 1x | ~1秒 |
| 1小时线 | 720条 | 24x | ~3-5秒 |

### 交易信号对比

| 策略类型 | 日线信号数 | 1小时线信号数 | 增幅 |
|---------|-----------|--------------|-----|
| MACD | 2-5次 | 15-30次 | 5-10倍 |
| RSI | 3-8次 | 20-40次 | 5-8倍 |
| 双均线 | 2-4次 | 10-20次 | 4-6倍 |

---

## 🎯 最佳实践

### 1. 回测区间选择

- **测试阶段**：7-14天（快速验证）
- **优化阶段**：30-60天（参数调优）
- **验证阶段**：180-365天（稳定性测试）

### 2. 策略参数

- 从日线参数开始，逐步调小
- 建议参数缩小到原来的 1/3 至 1/5
- 多次测试，找到最优参数组合

### 3. 风险控制

- 1小时线波动更频繁，建议：
  - 降低单次仓位（如从80%降至50%）
  - 设置更紧的止损（如从10%降至5%）
  - 增加手续费率考虑（短线交易成本更高）

### 4. 结果解读

- 1小时线回测结果仅供参考
- 实盘交易需考虑：
  - 滑点影响
  - 实际手续费
  - 网络延迟
  - 流动性问题

---

## 🔧 故障排除

### Q1: 选择1小时线后无法获取数据？

**可能原因：**
1. 回测区间超过730天
2. 网络连接问题
3. YFinance API暂时不可用

**解决方案：**
1. 缩短回测区间至730天以内
2. 检查网络连接
3. 稍后重试或切换到日线

### Q2: 1小时线数据条数不足？

**原因：**
- YFinance对不同代币的数据支持程度不同
- 新上市的代币历史数据较少

**解决方案：**
- 使用主流加密货币（BTC、ETH等）
- 缩短回测区间

### Q3: 为什么美股不能用1小时线？

**原因：**
- 美股仅交易日交易（周一至周五）
- 每天仅6.5小时交易时段
- 数据不连续，影响策略效果

**建议：**
- 美股使用日线数据
- 加密货币使用1小时线

---

## 📚 相关文档

- [YFinance数据源使用指南](./YFinance数据源使用指南.md)
- [YFinance快速参考](./YFinance快速参考.md)
- [数据源选择功能说明](./数据源选择功能说明.md)

---

## 🎉 总结

1. ✅ **加密货币专属**：仅加密货币支持1小时线
2. ✅ **灵活选择**：可在日线和1小时线之间切换
3. ✅ **智能提示**：自动显示数据限制和建议
4. ✅ **无缝集成**：所有策略自动支持1小时线
5. ✅ **完整数据**：加密货币24小时连续数据

现在就开始用1小时线测试您的短线策略吧！🚀

---

**版本：** 1.0  
**更新日期：** 2026-02-08  
**作者：** 量化回测系统开发团队


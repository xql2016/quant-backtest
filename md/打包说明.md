# 量化回测工作台 - Windows 打包说明

## 📦 打包概述

本文档说明如何将 Streamlit 应用打包成 Windows 可执行程序（.exe）。

## ⚠️ 重要提示

**跨平台打包限制：**
- 在 macOS 上无法直接打包 Windows 程序
- 在 Windows 上无法直接打包 macOS 程序
- **建议：在 Windows 系统上进行打包**

如果你只有 macOS，可以：
1. 使用 Windows 虚拟机（Parallels Desktop、VMware）
2. 使用云服务器（AWS、Azure）
3. 借用 Windows 电脑

## 🪟 在 Windows 上打包步骤

### 1. 准备环境

将整个 `quant` 文件夹复制到 Windows 电脑上。

### 2. 安装 Python

下载并安装 Python 3.9 或更高版本：
- 官网：https://www.python.org/downloads/
- ✅ 安装时勾选 "Add Python to PATH"

### 3. 安装依赖

打开命令提示符（CMD）或 PowerShell，进入项目目录：

```bash
cd C:\path\to\quant
pip install -r requirements.txt
pip install pyinstaller
```

### 4. 测试应用

打包前先测试应用是否能正常运行：

```bash
python run_app.py
```

如果能正常打开浏览器并显示应用，说明环境正常。

### 5. 开始打包

使用 PyInstaller 打包：

```bash
pyinstaller build_spec.spec
```

打包过程可能需要 5-10 分钟。

### 6. 查看结果

打包完成后，可执行文件位于：
```
dist/量化回测工作台/量化回测工作台.exe
```

### 7. 测试可执行文件

双击 `量化回测工作台.exe`，应该会：
1. 打开一个黑色命令窗口（显示启动信息）
2. 自动打开浏览器，显示应用界面

### 8. 分发程序

整个 `dist/量化回测工作台/` 文件夹都需要打包：
- 可以压缩成 zip 文件分发
- 也可以使用 NSIS、Inno Setup 制作安装程序

## 🎨 可选：添加图标

### 1. 准备图标文件

- 格式：.ico 文件
- 推荐尺寸：256x256 或 128x128
- 将图标文件命名为 `icon.ico` 放在项目根目录

### 2. 修改 build_spec.spec

找到这一行：
```python
icon=None,
```

改为：
```python
icon='icon.ico',
```

### 3. 重新打包

```bash
pyinstaller build_spec.spec
```

## 🔧 常见问题

### 问题1：打包后文件太大

**原因**：包含了所有依赖库

**解决方案**：
1. 使用虚拟环境，只安装必要的库
2. 可以尝试 `--onefile` 模式（单文件，但启动较慢）

修改打包命令：
```bash
pyinstaller --onefile run_app.py
```

### 问题2：打包后无法运行

**检查清单**：
1. 确保 Windows 防火墙允许程序运行
2. 检查杀毒软件是否拦截
3. 查看命令窗口的错误信息

### 问题3：缺少模块错误

**解决方案**：

在 `build_spec.spec` 的 `hiddenimports` 列表中添加缺失的模块。

例如，如果提示缺少 `某个模块`：
```python
hiddenimports=[
    ...
    '某个模块',
]
```

### 问题4：中文乱码

确保：
1. Python 文件使用 UTF-8 编码
2. Windows 系统区域设置支持中文

## 📝 简化版打包（仅生成单个 exe）

如果想要单个 exe 文件（但启动会慢一些）：

```bash
pyinstaller --onefile --name="量化回测工作台" --hidden-import=streamlit run_app.py
```

## 🚀 进阶：制作安装程序

使用 Inno Setup 制作专业的安装程序：

1. 下载 Inno Setup：https://jrsoftware.org/isinfo.php
2. 创建安装脚本
3. 生成安装程序（.exe）

## 💻 在 macOS/Linux 上的替代方案

### 方案1：Docker

创建 `Dockerfile`：
```dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY . /app
RUN pip install -r requirements.txt

CMD ["streamlit", "run", "多策略可视化回测_小红书20260117.py"]
```

### 方案2：Web 部署

将应用部署到云端：
- Streamlit Cloud（免费）：https://streamlit.io/cloud
- Heroku
- AWS/Azure

### 方案3：分享源代码

用户自行安装 Python 和依赖：
```bash
pip install -r requirements.txt
python run_app.py
```

## 📞 技术支持

如果打包过程中遇到问题：
1. 检查 Python 版本（建议 3.9-3.11）
2. 确保所有依赖都已安装
3. 查看打包时的错误日志
4. 尝试在干净的虚拟环境中打包

## 📦 文件清单

打包需要的文件：
- ✅ `多策略可视化回测_小红书20260117.py` - 主程序
- ✅ `run_app.py` - 启动脚本
- ✅ `requirements.txt` - 依赖列表
- ✅ `build_spec.spec` - PyInstaller 配置
- ⭐ `icon.ico` - 图标（可选）

## 🎯 最终产品

打包完成后，用户只需要：
1. 解压 zip 文件
2. 双击 `量化回测工作台.exe`
3. 自动打开浏览器，开始使用

无需安装 Python，无需配置环境！


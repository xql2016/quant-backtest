# 可转债功能当前限制说明

## ⚠️ 重要提示

经过测试，**可转债历史K线数据功能目前受限**，原因如下：

---

## 🔍 问题详情

### 技术原因

1. **AKShare 依赖问题**
   - AKShare 使用 `py_mini_racer` 库执行 JavaScript
   - 该库在 Mac 系统（特别是 M1/M2 芯片）上存在兼容性问题
   - 错误信息：`dlsym: symbol not found`

2. **接口状态**
   ```
   ✅ bond_zh_cov()          - 实时行情（可用）
   ❌ bond_zh_hs_cov_daily() - 历史K线（不可用）
   ```

---

## 💡 解决方案

### 方案1：尝试修复 py_mini_racer

```bash
# 步骤1：卸载旧版本
pip uninstall py-mini-racer

# 步骤2：重新安装
pip install --upgrade py-mini-racer

# 步骤3：测试
python3 test/check_akshare_bond_api.py
```

### 方案2：使用替代数据

由于可转债历史数据暂时不可用，**建议使用以下市场进行回测**：

#### ✅ 完全支持的市场

| 市场 | 数据源 | 粒度 | 状态 |
|-----|--------|------|------|
| **A股** | AKShare | 日线 | ✅ 完美支持 |
| **港股** | AKShare/YFinance | 日线 | ✅ 完美支持 |
| **美股** | YFinance | 日线 | ✅ 完美支持 |
| **加密货币** | YFinance | 1h/4h/1d | ✅ 完美支持 |
| ~~可转债~~ | ~~AKShare~~ | ~~日线~~ | ❌ 受限 |

---

## 📊 推荐使用方案

### 如果您对可转债感兴趣

**建议：使用可转债对应的正股进行回测**

#### 示例对照表

| 可转债代码 | 可转债名称 | 正股代码 | 正股名称 | 建议 |
|----------|----------|---------|---------|------|
| ~~128039~~ | 国光转债 | **002749** | 国光股份 | ✅ 用A股回测 |
| ~~113050~~ | 南银转债 | **601009** | 南京银行 | ✅ 用A股回测 |
| ~~127045~~ | 海亮转债 | **002203** | 海亮股份 | ✅ 用A股回测 |
| ~~113616~~ | 韦尔转债 | **603501** | 韦尔股份 | ✅ 用A股回测 |

**使用方法：**
```
1. 数据源：选择 AKShare
2. 市场：选择 A股
3. 代码：输入正股代码（如 002749）
4. 策略：使用相同的策略参数
5. 回测：正股走势与可转债高度相关
```

---

## 🎯 替代方案效果

### 为什么用正股可行？

1. **高度相关**
   - 可转债价格主要跟随正股走势
   - 转股溢价率在合理区间时，相关性 >0.8

2. **策略通用**
   - MACD、RSI、双均线等策略同样适用
   - 回测逻辑完全一致

3. **数据可靠**
   - A股数据完整、稳定
   - 无兼容性问题

### 差异说明

| 维度 | 可转债 | 正股 |
|-----|--------|------|
| 波动性 | 较小（有债底） | 较大 |
| 涨跌幅 | ±20% | ±10% |
| 交易规则 | T+0 | T+1 |
| 数据可用性 | ❌ 受限 | ✅ 完整 |

---

## 📝 当前建议

### 短期方案（立即可用）

```
✅ 使用 A股、港股、美股、加密货币 进行回测
✅ 如需研究可转债，使用对应正股代替
✅ 策略验证完成后，再考虑实盘可转债交易
```

### 中期方案（如需可转债数据）

```
1. 等待 py_mini_racer 库更新修复
2. 或使用其他数据源（如 Tushare、Wind）
3. 或使用本地CSV数据导入功能
```

---

## 🚀 推荐使用流程

### 如果您想研究可转债策略

#### 第1步：用正股验证策略
```
市场：A股
代码：002749（国光股份）
策略：MACD趋势策略
区间：最近1年
```

#### 第2步：分析回测结果
```
观察指标：
- 总收益率
- 胜率
- 最大回撤
- 交易频率
```

#### 第3步：调整参数优化
```
根据正股表现：
- 优化策略参数
- 调整止盈止损
- 控制仓位比例
```

#### 第4步：实盘应用
```
将验证好的策略：
- 应用到可转债实盘交易
- 考虑可转债特性微调
- 小仓位测试验证
```

---

## 💡 其他建议

### 如果您是可转债投资者

**推荐使用：**
1. ✅ **集思录网站**：https://www.jisilu.cn/data/cbnew/
   - 实时查看可转债行情
   - 筛选双低标的
   - 查看转股溢价率

2. ✅ **本系统用于正股回测**
   - 验证技术策略有效性
   - 测试不同策略表现
   - 优化参数组合

3. ✅ **结合使用效果最佳**
   - 用本系统测试正股策略
   - 在集思录筛选可转债
   - 实盘交易可转债

---

## 📚 总结

### 当前状态

- ❌ 可转债历史K线：暂不可用（技术限制）
- ✅ 其他所有市场：完全可用
- ✅ 策略回测功能：完整可用

### 建议

1. **短期**：使用正股代替可转债进行策略回测
2. **中期**：关注 py_mini_racer 库更新
3. **长期**：考虑集成其他可转债数据源

### 核心价值

本系统的核心价值在于**策略验证和参数优化**，而不是特定品种的数据：

```
✅ 验证 MACD 在不同参数下的表现
✅ 测试 RSI 超买超卖策略的胜率
✅ 优化双均线的周期组合
✅ 对比不同策略的风险收益比

这些能力完全可以通过A股等市场实现！
```

---

**结论**：虽然可转债历史数据暂时受限，但系统的其他功能完全可用，且通过正股回测可以达到类似的策略验证目的。

---

**更新日期**：2026-02-08  
**状态**：等待依赖库修复

